app.SFMTA_DEFAULT_LINES = [
  {
    'name': 'J Church',
    'color':'#FAA635',
    'coordinates': [[[37.720934,-122.446726],[37.720917,-122.446635],[37.720926,-122.446531],[37.720979,-122.446451],[37.721407,-122.446096],[37.721452,-122.446016],[37.72163,-122.445856],[37.722701,-122.444951],[37.722969,-122.444756],[37.724994,-122.443072]],[[37.724994,-122.443072],[37.725797,-122.442396],[37.726761,-122.441583],[37.726939,-122.441446],[37.727448,-122.441114],[37.727956,-122.44077],[37.728188,-122.440609],[37.728438,-122.440449],[37.728858,-122.440163],[37.728929,-122.440071],[37.729241,-122.439556]],[[37.729241,-122.439556],[37.729589,-122.438983],[37.729669,-122.438857],[37.729919,-122.438467],[37.730133,-122.438158],[37.730187,-122.438009],[37.730231,-122.437837],[37.730258,-122.437494],[37.730454,-122.436543],[37.730535,-122.436142],[37.730651,-122.435821]],[[37.730651,-122.435821],[37.730776,-122.435649],[37.730847,-122.435558],[37.731088,-122.435409],[37.731347,-122.435271],[37.731534,-122.435145],[37.73181,-122.434882],[37.732042,-122.434492],[37.733568,-122.431284],[37.734995,-122.428535],[37.735468,-122.427802]],[[37.735468,-122.427802],[37.736387,-122.426564],[37.737261,-122.425521],[37.73776,-122.425029],[37.738099,-122.424799],[37.738429,-122.424605],[37.738983,-122.424375],[37.739652,-122.424215],[37.739875,-122.424157],[37.740062,-122.4241],[37.740651,-122.423848]],[[37.740651,-122.423848],[37.741695,-122.423527],[37.742114,-122.423366],[37.742302,-122.423286],[37.742239,-122.424237],[37.742142,-122.425818],[37.742097,-122.426528],[37.7429,-122.426597],[37.743703,-122.426677],[37.744497,-122.426757],[37.7453,-122.426825]],[[37.7453,-122.426825],[37.746103,-122.426894],[37.746505,-122.426939],[37.746897,-122.426974],[37.747701,-122.427053],[37.748495,-122.427133],[37.749298,-122.427202],[37.750101,-122.427282],[37.750895,-122.427362],[37.751707,-122.427442],[37.752456,-122.42751]],[[37.752456,-122.42751],[37.753295,-122.42759],[37.754901,-122.427739],[37.754964,-122.427659],[37.755044,-122.427567],[37.755142,-122.427464],[37.755312,-122.427326],[37.755401,-122.427292],[37.755481,-122.42728],[37.755892,-122.427326],[37.755963,-122.427303]],[[37.755963,-122.427303],[37.756034,-122.42728],[37.756124,-122.427211],[37.756231,-122.427062],[37.756338,-122.426971],[37.756427,-122.426913],[37.756561,-122.426879],[37.757051,-122.426925],[37.757355,-122.426959],[37.757462,-122.426959],[37.757498,-122.42697]],[[37.757498,-122.42697],[37.75756,-122.427005],[37.757605,-122.427062],[37.757658,-122.427131],[37.757676,-122.427188],[37.757685,-122.427257],[37.757694,-122.42744],[37.757712,-122.427555],[37.75773,-122.427646],[37.757756,-122.427715],[37.757792,-122.427761]],[[37.757792,-122.427761],[37.757837,-122.427795],[37.757872,-122.427818],[37.757926,-122.427841],[37.757997,-122.427853],[37.758104,-122.427864],[37.758934,-122.427898],[37.759434,-122.427955],[37.759603,-122.427967],[37.759711,-122.427978],[37.760317,-122.428035]],[[37.760317,-122.428035],[37.760621,-122.428058],[37.760754,-122.428093],[37.761102,-122.428207],[37.76129,-122.428356],[37.762093,-122.428436],[37.762896,-122.428516],[37.763583,-122.428585],[37.764511,-122.428676],[37.766135,-122.428825],[37.767509,-122.42895]],[[37.767509,-122.42895],[37.767732,-122.428973],[37.768678,-122.429065],[37.769463,-122.429133],[37.769401,-122.428996],[37.769534,-122.426692],[37.769605,-122.426314],[37.770738,-122.424858],[37.771425,-122.423987],[37.771711,-122.42362],[37.772496,-122.422622]],[[37.772496,-122.422622],[37.772852,-122.422175],[37.773031,-122.421946],[37.773548,-122.421293],[37.773771,-122.421017],[37.774003,-122.420708],[37.774351,-122.420261],[37.775145,-122.419263],[37.775582,-122.41869],[37.776536,-122.417509],[37.777491,-122.416294]],[[37.777491,-122.416294],[37.777785,-122.415927],[37.778713,-122.414746],[37.78047,-122.412521],[37.780898,-122.411982],[37.781183,-122.411627],[37.782227,-122.410297],[37.783279,-122.408955],[37.783984,-122.408072],[37.785741,-122.405836],[37.786722,-122.404586]],[[37.786722,-122.404586],[37.787632,-122.403439],[37.788078,-122.402911],[37.788711,-122.402074],[37.789255,-122.401386],[37.790298,-122.400067],[37.790735,-122.399482],[37.791012,-122.399149],[37.791707,-122.398266],[37.792403,-122.397394],[37.793089,-122.396511]],[[37.793089,-122.396511],[37.79325,-122.396305],[37.793776,-122.395628],[37.794472,-122.394756],[37.794213,-122.393885],[37.793677,-122.393003],[37.793266,-122.392418],[37.792846,-122.391708],[37.792427,-122.3911],[37.792248,-122.390963],[37.792025,-122.390837]],[[37.792025,-122.390837],[37.791588,-122.390723],[37.791284,-122.390494],[37.791088,-122.390333],[37.79082,-122.390013],[37.78957,-122.388489],[37.789454,-122.388374],[37.789294,-122.38826],[37.789008,-122.388123],[37.788473,-122.387951],[37.788249,-122.387894]],[[37.788249,-122.387894],[37.78791,-122.387825],[37.787098,-122.387872],[37.78477,-122.388034],[37.783226,-122.38815],[37.78179,-122.388312],[37.781486,-122.388312],[37.781237,-122.388358],[37.78104,-122.388404],[37.78088,-122.388485],[37.780692,-122.388599]],[[37.780692,-122.388599],[37.780389,-122.388875],[37.779854,-122.389597],[37.778124,-122.391845],[37.776323,-122.394036],[37.775806,-122.394689],[37.774575,-122.39626],[37.774129,-122.396857],[37.773425,-122.397614]]]
  },
  {
    'name': 'F Market & Wharves',
    'color': '#EB7B1D',
    'coordinates': [[[37.76262,-122.432951],[37.762558,-122.434062],[37.762504,-122.434945],[37.762558,-122.434062],[37.76262,-122.432951],[37.762673,-122.432126],[37.762709,-122.431553],[37.762754,-122.430728],[37.762896,-122.428516],[37.762093,-122.428436]],[[37.762093,-122.428436],[37.76129,-122.428356],[37.761102,-122.428207],[37.760754,-122.428093],[37.760621,-122.428058],[37.760317,-122.428035],[37.759711,-122.427978],[37.759603,-122.427967],[37.759434,-122.427955],[37.758934,-122.427898],[37.758104,-122.427864]],[[37.758104,-122.427864],[37.757997,-122.427853],[37.757926,-122.427841],[37.757872,-122.427818],[37.757837,-122.427795],[37.757792,-122.427761],[37.757756,-122.427715],[37.75773,-122.427646],[37.757712,-122.427555],[37.757694,-122.42744],[37.757685,-122.427257]],[[37.757685,-122.427257],[37.757676,-122.427188],[37.757658,-122.427131],[37.757605,-122.427062],[37.75756,-122.427005],[37.757498,-122.42697],[37.757462,-122.426959],[37.757355,-122.426959],[37.757051,-122.426925],[37.756561,-122.426879],[37.756427,-122.426913]],[[37.756427,-122.426913],[37.756338,-122.426971],[37.756231,-122.427062],[37.756124,-122.427211],[37.756034,-122.42728],[37.755963,-122.427303],[37.755892,-122.427326],[37.755481,-122.42728],[37.755401,-122.427292],[37.755312,-122.427326],[37.755142,-122.427464]],[[37.755142,-122.427464],[37.755044,-122.427567],[37.754964,-122.427659],[37.754901,-122.427739],[37.753295,-122.42759],[37.752456,-122.42751],[37.751707,-122.427442],[37.750895,-122.427362],[37.750101,-122.427282],[37.749298,-122.427202],[37.748495,-122.427133]],[[37.748495,-122.427133],[37.747701,-122.427053],[37.746897,-122.426974],[37.746505,-122.426939],[37.746103,-122.426894],[37.7453,-122.426825],[37.744497,-122.426757],[37.743703,-122.426677],[37.7429,-122.426597],[37.742097,-122.426528],[37.742142,-122.425818]],[[37.742142,-122.425818],[37.742239,-122.424237],[37.742302,-122.423286],[37.742114,-122.423366],[37.741695,-122.423527],[37.740651,-122.423848],[37.740062,-122.4241],[37.739875,-122.424157],[37.739652,-122.424215],[37.738983,-122.424375],[37.738429,-122.424605]],[[37.738429,-122.424605],[37.738099,-122.424799],[37.73776,-122.425029],[37.737261,-122.425521],[37.736387,-122.426564],[37.735468,-122.427802],[37.734995,-122.428535],[37.734379,-122.429703],[37.733898,-122.430689],[37.733282,-122.431926],[37.732899,-122.432762]],[[37.732899,-122.432762],[37.732042,-122.434492],[37.73181,-122.434882],[37.731534,-122.435145],[37.731347,-122.435271],[37.731088,-122.435409],[37.730847,-122.435558],[37.730776,-122.435649],[37.730651,-122.435821],[37.730535,-122.436142],[37.730454,-122.436543]],[[37.730454,-122.436543],[37.730258,-122.437494],[37.730231,-122.437837],[37.730187,-122.438009],[37.730133,-122.438158],[37.729919,-122.438467],[37.729669,-122.438857],[37.729589,-122.438983],[37.729241,-122.439556],[37.728929,-122.440071],[37.728858,-122.440163]],[[37.728858,-122.440163],[37.728438,-122.440449],[37.728188,-122.440609],[37.727956,-122.44077],[37.727448,-122.441114],[37.726939,-122.441446],[37.726761,-122.441583],[37.725797,-122.442396],[37.724994,-122.443072],[37.722969,-122.444756],[37.722701,-122.444951]],[[37.722701,-122.444951],[37.72163,-122.445856],[37.720729,-122.446612]]]
  },
  {
    'name': 'KT Ingleside / Third',
    'color': '#D21245',
    'coordinates': [[[37.720872,-122.446783],[37.720854,-122.446669],[37.72089,-122.446566],[37.721675,-122.445924],[37.721425,-122.446131],[37.721042,-122.446451],[37.721425,-122.446131],[37.721675,-122.445924],[37.722505,-122.445237],[37.722808,-122.445008]],[[37.722808,-122.445008],[37.722862,-122.445008],[37.722906,-122.445077],[37.722897,-122.446188],[37.722906,-122.447081],[37.722933,-122.447161],[37.72296,-122.447207],[37.72296,-122.447276],[37.72296,-122.449154],[37.72296,-122.449555],[37.722996,-122.451594]],[[37.722996,-122.451594],[37.723013,-122.452018],[37.723085,-122.452327],[37.723245,-122.453106],[37.723459,-122.454114],[37.723674,-122.455133],[37.723888,-122.456141],[37.723968,-122.456507],[37.724102,-122.45716],[37.724137,-122.457332],[37.724325,-122.45818]],[[37.724325,-122.45818],[37.724539,-122.459211],[37.72469,-122.459944],[37.724753,-122.46023],[37.724949,-122.461204],[37.72527,-122.462212],[37.725484,-122.462807],[37.725868,-122.463838],[37.726002,-122.464216],[37.726135,-122.464571],[37.726412,-122.465304]],[[37.726412,-122.465304],[37.726563,-122.465671],[37.726786,-122.466072],[37.727241,-122.466679],[37.727777,-122.467321],[37.728035,-122.467492],[37.72833,-122.467733],[37.728981,-122.468065],[37.729222,-122.468203],[37.729606,-122.468604],[37.729838,-122.468902]],[[37.729838,-122.468902],[37.72998,-122.469337],[37.73031,-122.470105],[37.731033,-122.471789],[37.734709,-122.471561],[37.735003,-122.471389],[37.73561,-122.471057],[37.736592,-122.470565],[37.737225,-122.469901],[37.737975,-122.469053],[37.739724,-122.46698]],[[37.739724,-122.46698],[37.740893,-122.465823],[37.74374,-122.463681],[37.748282,-122.458756],[37.752422,-122.455124],[37.758829,-122.441053],[37.762674,-122.435197],[37.762852,-122.434956],[37.763138,-122.434567],[37.764039,-122.43334],[37.764199,-122.433077]],[[37.764199,-122.433077],[37.765868,-122.431036],[37.766019,-122.43083],[37.767509,-122.42895],[37.767741,-122.428664],[37.768776,-122.427357],[37.769106,-122.426944],[37.769605,-122.426314],[37.769603,-122.42631],[37.770748,-122.424853],[37.771435,-122.423986]],[[37.771435,-122.423986],[37.771717,-122.42362],[37.772503,-122.42262],[37.772856,-122.42217],[37.773036,-122.421941],[37.773557,-122.421289],[37.773781,-122.421008],[37.774008,-122.420699],[37.774359,-122.420254],[37.775147,-122.419256],[37.775587,-122.418684]],[[37.775587,-122.418684],[37.776541,-122.417501],[37.777494,-122.416292],[37.777795,-122.415926],[37.778719,-122.414741],[37.780479,-122.412512],[37.780903,-122.411973],[37.78119,-122.411625],[37.782231,-122.410292],[37.783288,-122.408952],[37.783992,-122.408067]],[[37.783992,-122.408067],[37.785744,-122.405831],[37.786731,-122.404583],[37.787642,-122.403431],[37.788086,-122.402903],[37.788721,-122.402066],[37.789264,-122.401376],[37.790304,-122.400067],[37.790744,-122.39948],[37.791017,-122.399149],[37.791716,-122.398264]],[[37.791716,-122.398264],[37.792406,-122.397384],[37.793097,-122.396504],[37.793256,-122.396302],[37.793779,-122.395623],[37.79448,-122.394748],[37.794248,-122.393965],[37.7939,-122.393381],[37.793516,-122.392773],[37.793052,-122.392109],[37.792721,-122.391479]],[[37.792721,-122.391479],[37.792256,-122.390954],[37.792034,-122.390836],[37.791594,-122.390713],[37.791286,-122.390493],[37.791096,-122.390324],[37.790827,-122.390013],[37.789572,-122.388481],[37.789463,-122.388367],[37.789302,-122.388253],[37.789013,-122.388113]],[[37.789013,-122.388113],[37.788475,-122.387949],[37.788258,-122.387888],[37.787917,-122.387819],[37.7871,-122.387862],[37.784774,-122.388024],[37.783234,-122.388147],[37.781798,-122.388306],[37.781488,-122.388309],[37.781246,-122.388352],[37.78105,-122.388402]],[[37.78105,-122.388402],[37.780883,-122.388479],[37.780702,-122.388596],[37.780392,-122.388874],[37.779861,-122.389591],[37.778124,-122.391845],[37.776323,-122.394036],[37.775787,-122.39336],[37.775787,-122.393355],[37.775562,-122.393056],[37.775027,-122.392346]],[[37.775027,-122.392346],[37.77468,-122.391912],[37.774822,-122.389899],[37.772931,-122.389717],[37.766903,-122.389099],[37.766907,-122.389103],[37.764329,-122.388853],[37.763053,-122.38874],[37.761768,-122.388695],[37.760492,-122.388558],[37.75794,-122.38832]],[[37.75794,-122.38832],[37.755397,-122.388001],[37.754112,-122.387887],[37.752836,-122.387762],[37.75156,-122.387637],[37.750266,-122.387593],[37.749008,-122.387456],[37.746161,-122.387184],[37.745073,-122.387139],[37.744261,-122.38738],[37.744118,-122.38746]],[[37.744118,-122.38746],[37.743529,-122.387633],[37.742709,-122.387931],[37.741888,-122.388207],[37.741112,-122.388482],[37.740318,-122.388758],[37.739533,-122.389033],[37.739024,-122.389194],[37.738748,-122.38932],[37.737954,-122.389596],[37.737169,-122.389872]],[[37.737169,-122.389872],[37.736392,-122.390147],[37.73559,-122.390423],[37.734796,-122.390698],[37.734019,-122.390974],[37.733225,-122.391249],[37.732431,-122.391525],[37.732262,-122.391514],[37.731753,-122.391697],[37.731646,-122.3918],[37.730861,-122.392076]],[[37.730861,-122.392076],[37.730647,-122.392156],[37.730067,-122.392351],[37.729282,-122.392627],[37.728845,-122.392799],[37.728497,-122.392902],[37.727739,-122.393235],[37.726981,-122.393579],[37.72624,-122.393912],[37.725482,-122.394245],[37.724724,-122.394589]],[[37.724724,-122.394589],[37.723974,-122.394933],[37.723225,-122.395266],[37.722431,-122.395633],[37.721717,-122.395954],[37.720986,-122.396275],[37.720718,-122.39639],[37.720236,-122.396619],[37.719478,-122.396963],[37.718836,-122.397479],[37.718729,-122.397502]],[[37.718729,-122.397502],[37.718185,-122.397984],[37.717792,-122.398167],[37.717471,-122.398236],[37.716623,-122.398237],[37.716311,-122.398306],[37.71599,-122.398489],[37.715455,-122.398844],[37.715339,-122.398993],[37.714366,-122.399361],[37.713885,-122.399819]],[[37.713885,-122.399819],[37.713608,-122.400082],[37.713064,-122.400667],[37.712966,-122.40077],[37.712797,-122.400919],[37.712547,-122.401286],[37.712413,-122.401641],[37.712297,-122.402133],[37.712235,-122.402328],[37.712182,-122.402465],[37.712093,-122.402786]],[[37.712093,-122.402786],[37.711968,-122.403015],[37.711789,-122.40321],[37.711192,-122.403657],[37.710416,-122.40423],[37.70972,-122.404643],[37.709363,-122.404849],[37.708854,-122.405113]]]
  },
  {
    'name':'N Judah',
    'color':'#01529A',
    'coordinates':[[[37.773425,-122.397614],[37.774129,-122.396857],[37.774575,-122.39626],[37.775806,-122.394689],[37.776323,-122.394036],[37.778124,-122.391845],[37.779854,-122.389597],[37.780389,-122.388875],[37.780692,-122.388599],[37.78088,-122.388485]],[[37.78088,-122.388485],[37.78104,-122.388404],[37.781237,-122.388358],[37.781486,-122.388312],[37.78179,-122.388312],[37.783226,-122.38815],[37.78477,-122.388034],[37.787098,-122.387872],[37.78791,-122.387825],[37.788249,-122.387894],[37.788473,-122.387951]],[[37.788473,-122.387951],[37.789008,-122.388123],[37.789294,-122.38826],[37.789454,-122.388374],[37.78957,-122.388489],[37.79082,-122.390013],[37.791088,-122.390333],[37.791284,-122.390494],[37.791588,-122.390723],[37.792025,-122.390837],[37.792248,-122.390963]],[[37.792248,-122.390963],[37.792427,-122.3911],[37.792846,-122.391708],[37.793266,-122.392418],[37.793677,-122.393003],[37.794213,-122.393885],[37.794472,-122.394756],[37.793776,-122.395628],[37.79325,-122.396305],[37.793089,-122.396511],[37.792403,-122.397394]],[[37.792403,-122.397394],[37.791707,-122.398266],[37.791012,-122.399149],[37.790735,-122.399482],[37.790298,-122.400067],[37.789255,-122.401386],[37.788711,-122.402074],[37.788078,-122.402911],[37.787632,-122.403439],[37.786722,-122.404586],[37.785741,-122.405836]],[[37.785741,-122.405836],[37.783984,-122.408072],[37.783279,-122.408955],[37.782227,-122.410297],[37.781183,-122.411627],[37.780898,-122.411982],[37.78047,-122.412521],[37.778713,-122.414746],[37.777785,-122.415927],[37.777491,-122.416294],[37.776536,-122.417509]],[[37.776536,-122.417509],[37.775582,-122.41869],[37.775145,-122.419263],[37.774351,-122.420261],[37.774003,-122.420708],[37.773771,-122.421017],[37.773548,-122.421293],[37.773031,-122.421946],[37.772852,-122.422175],[37.772496,-122.422622],[37.771711,-122.42362]],[[37.771711,-122.42362],[37.771425,-122.423987],[37.770738,-122.424858],[37.769605,-122.426314],[37.769534,-122.426692],[37.769401,-122.428996],[37.769463,-122.429133],[37.76941,-122.429912],[37.769392,-122.430256],[37.769321,-122.431368],[37.769312,-122.431574]],[[37.769312,-122.431574],[37.769249,-122.432468],[37.769214,-122.433007],[37.769258,-122.433156],[37.769321,-122.433385],[37.769258,-122.433156],[37.769321,-122.433385],[37.769268,-122.4346],[37.766431,-122.448662],[37.766386,-122.448834],[37.766297,-122.449029]],[[37.766297,-122.449029],[37.765985,-122.449361],[37.765887,-122.449499],[37.765842,-122.449636],[37.765806,-122.449957],[37.765619,-122.451401],[37.765449,-122.452753],[37.765235,-122.454403],[37.764932,-122.456753],[37.764816,-122.457715],[37.764557,-122.457692]],[[37.764557,-122.457692],[37.764414,-122.457818],[37.764369,-122.458804],[37.764325,-122.459881],[37.764271,-122.460947],[37.764226,-122.462024],[37.764182,-122.463101],[37.764137,-122.464167],[37.764083,-122.465244],[37.764038,-122.46631],[37.762174,-122.466172]],[[37.762174,-122.466172],[37.762129,-122.467249],[37.762084,-122.468315],[37.762039,-122.469381],[37.761994,-122.470458],[37.761941,-122.471535],[37.761896,-122.472658],[37.761842,-122.473781],[37.761797,-122.474847],[37.761752,-122.475912],[37.761699,-122.477001]],[[37.761699,-122.477001],[37.761654,-122.478055],[37.761609,-122.479132],[37.761564,-122.480198],[37.761519,-122.481275],[37.761465,-122.482341],[37.76142,-122.483418],[37.761375,-122.484495],[37.761322,-122.485561],[37.761277,-122.486638],[37.761232,-122.487704]],[[37.761232,-122.487704],[37.761187,-122.48877],[37.761133,-122.489847],[37.761088,-122.490912],[37.761043,-122.49199],[37.760998,-122.493067],[37.760944,-122.494132],[37.760926,-122.494682],[37.760899,-122.49521],[37.760881,-122.495748],[37.760854,-122.496275]],[[37.760854,-122.496275],[37.760809,-122.497352],[37.760755,-122.498418],[37.76071,-122.499495],[37.760665,-122.500561],[37.76062,-122.501638],[37.760566,-122.502704],[37.760521,-122.503781],[37.760475,-122.504846],[37.76043,-122.505924],[37.760376,-122.506989]],[[37.760376,-122.506989],[37.760331,-122.508066],[37.760358,-122.508135],[37.760349,-122.508525],[37.760331,-122.509098],[37.760322,-122.509178],[37.760286,-122.509247],[37.760232,-122.509281],[37.760179,-122.509292],[37.760116,-122.509269],[37.76009,-122.509246]],[[37.76009,-122.509246],[37.760063,-122.509212],[37.760045,-122.509166]]]
  },
  {
    'name': 'L Taraval',
    'color': '#91278D',
    'coordinates': [[[37.793097,-122.396504],[37.792406,-122.397384],[37.791716,-122.398264],[37.791017,-122.399149],[37.790744,-122.39948],[37.790304,-122.400067],[37.789264,-122.401376],[37.788721,-122.402066],[37.788086,-122.402903],[37.787642,-122.403431]],[[37.787642,-122.403431],[37.786731,-122.404583],[37.785744,-122.405831],[37.783992,-122.408067],[37.783288,-122.408952],[37.782231,-122.410292],[37.78119,-122.411625],[37.780903,-122.411973],[37.780479,-122.412512],[37.778719,-122.414741],[37.777795,-122.415926]],[[37.777795,-122.415926],[37.777494,-122.416292],[37.776541,-122.417501],[37.775587,-122.418684],[37.775147,-122.419256],[37.774359,-122.420254],[37.774008,-122.420699],[37.773781,-122.421008],[37.773557,-122.421289],[37.773036,-122.421941],[37.772856,-122.42217]],[[37.772856,-122.42217],[37.772503,-122.42262],[37.771717,-122.42362],[37.771435,-122.423986],[37.770748,-122.424853],[37.769603,-122.42631],[37.769605,-122.426314],[37.769106,-122.426944],[37.768776,-122.427357],[37.767741,-122.428664],[37.767509,-122.42895]],[[37.767509,-122.42895],[37.766019,-122.43083],[37.765868,-122.431036],[37.764199,-122.433077],[37.764039,-122.43334],[37.763138,-122.434567],[37.762852,-122.434956],[37.762674,-122.435197],[37.758829,-122.441053],[37.752422,-122.455124],[37.748282,-122.458756]],[[37.748282,-122.458756],[37.74374,-122.463681],[37.740893,-122.465823],[37.741045,-122.466121],[37.741286,-122.466579],[37.74133,-122.466705],[37.741411,-122.466969],[37.7415,-122.467462],[37.741509,-122.467622],[37.741509,-122.467759],[37.741508,-122.46855]],[[37.741508,-122.46855],[37.741491,-122.468664],[37.741473,-122.46902],[37.741428,-122.470096],[37.741383,-122.471219],[37.743239,-122.471346],[37.743194,-122.472469],[37.743149,-122.473545],[37.743096,-122.474622],[37.743051,-122.475642],[37.743006,-122.476753]],[[37.743006,-122.476753],[37.742961,-122.47783],[37.742916,-122.478896],[37.742862,-122.479972],[37.742817,-122.481049],[37.742772,-122.482115],[37.742719,-122.48318],[37.742674,-122.484257],[37.742629,-122.485334],[37.742584,-122.486399],[37.742539,-122.487465]],[[37.742539,-122.487465],[37.742485,-122.488542],[37.74244,-122.489619],[37.742395,-122.490684],[37.74235,-122.491761],[37.742296,-122.492826],[37.742251,-122.493903],[37.742224,-122.494442],[37.742206,-122.494969],[37.742152,-122.496045],[37.742107,-122.497111]],[[37.742107,-122.497111],[37.742062,-122.498188],[37.742008,-122.499253],[37.741963,-122.50033],[37.741909,-122.501395],[37.741864,-122.502472],[37.741819,-122.503538],[37.741765,-122.504614],[37.739909,-122.504487],[37.738053,-122.504348],[37.738008,-122.505425]],[[37.738008,-122.505425],[37.737071,-122.505356],[37.736134,-122.505286],[37.736179,-122.504404]]]
  },
  { 
    'name':'M Ocean View',
    'color':'#018752',
    'coordinates':[[[37.720729,-122.446612],[37.720158,-122.447093],[37.71948,-122.447562],[37.718927,-122.447952],[37.718597,-122.448295],[37.7184,-122.448604],[37.718177,-122.448879],[37.717883,-122.449074],[37.717544,-122.449257],[37.717116,-122.449566]],[[37.717116,-122.449566],[37.71617,-122.450368],[37.715501,-122.450952],[37.714385,-122.451903],[37.714109,-122.452166],[37.713707,-122.452532],[37.713216,-122.453449],[37.713198,-122.456048],[37.713171,-122.459014],[37.713153,-122.462564],[37.713903,-122.462553]],[[37.713903,-122.462553],[37.714036,-122.462587],[37.714313,-122.462599],[37.714304,-122.463492],[37.714295,-122.464397],[37.714286,-122.46529],[37.714286,-122.466195],[37.714277,-122.467088],[37.714268,-122.467993],[37.714259,-122.468886],[37.71425,-122.469573]],[[37.71425,-122.469573],[37.714285,-122.469791],[37.714464,-122.469986],[37.714972,-122.470467],[37.715213,-122.470696],[37.716132,-122.471566],[37.717176,-122.472563],[37.719531,-122.474728],[37.719923,-122.474969],[37.72045,-122.475221],[37.721056,-122.47521]],[[37.721056,-122.47521],[37.723082,-122.475096],[37.724929,-122.474994],[37.726919,-122.474903],[37.729007,-122.474801],[37.729631,-122.474766],[37.730336,-122.474801],[37.73047,-122.474629],[37.730693,-122.474549],[37.731059,-122.474377],[37.731095,-122.474355]],[[37.731095,-122.474355],[37.731327,-122.474206],[37.731916,-122.473748],[37.733442,-122.47258],[37.734245,-122.47195],[37.734709,-122.471561],[37.735003,-122.471389],[37.73561,-122.471057],[37.736592,-122.470565],[37.737225,-122.469901],[37.737975,-122.469053]],[[37.737975,-122.469053],[37.739724,-122.46698],[37.740893,-122.465823],[37.74374,-122.463681],[37.748282,-122.458756],[37.752422,-122.455124],[37.758829,-122.441053],[37.762674,-122.435197],[37.762852,-122.434956],[37.763138,-122.434567],[37.764039,-122.43334]],[[37.764039,-122.43334],[37.764199,-122.433077],[37.765868,-122.431036],[37.766019,-122.43083],[37.767509,-122.42895],[37.767741,-122.428664],[37.768776,-122.427357],[37.769106,-122.426944],[37.769605,-122.426314],[37.769603,-122.42631],[37.770748,-122.424853]],[[37.770748,-122.424853],[37.771435,-122.423986],[37.771717,-122.42362],[37.772503,-122.42262],[37.772856,-122.42217],[37.773036,-122.421941],[37.773557,-122.421289],[37.773781,-122.421008],[37.774008,-122.420699],[37.774359,-122.420254],[37.775147,-122.419256]],[[37.775147,-122.419256],[37.775587,-122.418684],[37.776541,-122.417501],[37.777494,-122.416292],[37.777795,-122.415926],[37.778719,-122.414741],[37.780479,-122.412512],[37.780903,-122.411973],[37.78119,-122.411625],[37.782231,-122.410292],[37.783288,-122.408952]],[[37.783288,-122.408952],[37.783992,-122.408067],[37.785744,-122.405831],[37.786731,-122.404583],[37.787642,-122.403431],[37.788086,-122.402903],[37.788721,-122.402066],[37.789264,-122.401376],[37.790304,-122.400067],[37.790744,-122.39948],[37.791017,-122.399149]],[[37.791017,-122.399149],[37.791716,-122.398264],[37.792406,-122.397384],[37.793097,-122.396504]]]
  }
];

// Controls top-level logic for which views to show at any given time. 
app.AppController = app.Controller.extend({
  initialize: function() {
    this.listenTo(app.events, 'app:showMap',           this.showMap);
    this.listenTo(app.events, 'app:showHome',          this.showHome);
    this.listenTo(app.events, 'app:showNotification',  this.showNotification);
    this.listenTo(app.events, 'app:createMap',         this.createMap);
    this.listenTo(app.events, 'app:remixMap',          this.remixMap);

    this.setupViews();
  },

  setupViews: function() {
    var options = {
      tileLayer: { detectRetina: true },
      infoControl: false,
      boxZoom: false,
    };
    app.leaflet = L.mapbox.map('map', 'codeforamerica.h6mlbj75', options);

    this.feedbackView = new app.FeedbackView();
    $('body').append(this.feedbackView.render().el);
  },

  showMap: function(mapId, lineId) {
    // If we're already viewing this map (i.e., back button), avoid loading it a second time
    var isLoaded = this.mapController && this.mapController.map.id === mapId;
    if (isLoaded) {
      this.mapController.selectLine(lineId);
      return;
    }

    this._closeControllers();
    this.mapController = new app.MapController({
      mapId: mapId,
      lineId: lineId,
      router: this.router
    });
    this.router.navigate('/map/' + mapId);
  },

  showHome: function() {
    this._closeControllers();
    // this.homeController = new app.HomeController({ router: this });
    this.router.navigate('/');
    app.events.trigger('app:createMap');
  },

  remixMap: function(mapId) {
    var afterRemix = function(resp) {
      var message = 'Now editing a freshly-made duplicate of the original map.';
      app.events.trigger('app:showNotification', message);

      var map = new app.Map(resp, { parse: true });
      this._closeControllers();
      this.mapController = new app.MapController({ map: map, router: this.router });
    };

    var url = '/api/maps/' + mapId + '/remix';
    $.post(url, _.bind(afterRemix, this));
  },

  createMap: function(city) {

    var afterCreate = function(map) {
      map.get('lines').create(app.SFMTA_DEFAULT_LINES[0]);
      map.get('lines').create(app.SFMTA_DEFAULT_LINES[1]);
      map.get('lines').create(app.SFMTA_DEFAULT_LINES[2]);
      map.get('lines').create(app.SFMTA_DEFAULT_LINES[3]);
      map.get('lines').create(app.SFMTA_DEFAULT_LINES[4]);
      map.get('lines').create(app.SFMTA_DEFAULT_LINES[5]);

      this._closeControllers();
      this.mapController = new app.MapController({ map: map, router: this.router });
    };

    var map = new app.Map({ name: name, center: [37.7749295, -122.419415], name: 'San Francisco' });
    map.save({}, { success:  _.bind(afterCreate, this)});
  },

  // When switching between controllers, close the other ones
  _closeControllers: function() {
    if (this.mapController) {
      this.mapController.close();
      delete this.mapController;
    }
    if (this.homeController) {
      this.homeController.close();
      delete this.homeController;
    }
  },

  showNotification: function(message) {
    var notification = new app.NotificationView({ message: message });
    $('body').append(notification.render().el);
  },
});
